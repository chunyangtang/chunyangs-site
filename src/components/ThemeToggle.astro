---
import { Sun, Moon } from 'lucide-react';
---

<button
  id="theme-toggle"
  type="button"
  class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700/50 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 transition-colors"
  aria-label="Toggle Dark Mode"
>
  <Sun id="theme-toggle-light-icon" class="hidden w-5 h-5" />
  <Moon id="theme-toggle-dark-icon" class="hidden w-5 h-5" />
</button>

<script>
  const THEME_STORAGE_KEY = 'color-theme';

  const getSystemTheme = () =>
    window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';

  function initThemeToggle() {
    const themeToggleBtn = document.getElementById('theme-toggle');
    const lightIcon = document.getElementById('theme-toggle-light-icon');
    const darkIcon = document.getElementById('theme-toggle-dark-icon');

    const updateIcons = () => {
      const isDark = document.documentElement.classList.contains('dark');
      if (isDark) {
        darkIcon?.classList.add('hidden');
        lightIcon?.classList.remove('hidden');
      } else {
        lightIcon?.classList.add('hidden');
        darkIcon?.classList.remove('hidden');
      }
    };

    updateIcons();

    const handleToggle = () => {
      document.documentElement.classList.toggle('dark');

      const nextTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
      if (nextTheme === getSystemTheme()) {
        localStorage.removeItem(THEME_STORAGE_KEY);
      } else {
        localStorage.setItem(THEME_STORAGE_KEY, nextTheme);
      }

      updateIcons();
    };

    if (themeToggleBtn) {
      themeToggleBtn.onclick = handleToggle;
    }
  }

  initThemeToggle();
  if (!window.__themeTogglePageLoadBound) {
    document.addEventListener('astro:page-load', initThemeToggle);
    window.__themeTogglePageLoadBound = true;
  }
</script>
